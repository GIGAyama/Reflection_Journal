
<!DOCTYPE html>
<html lang="ja">

<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ふり返りジャーナル</title>

  <!-- ── Google Fonts: Zen Maru Gothic (wght@500;700) ── -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">

  <!-- ── Bootstrap 5 CSS (CDN) ── -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- ── Bootstrap Icons (CDN) ── -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

  <!-- ── SweetAlert2 CSS (CDN) ── -->
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">

  <!-- ── アプリ固有CSS（css.html） ── -->
  <?!= include('css') ?>
</head>

<body>

  <!-- ============================================================
       全画面スピナー（ローディングオーバーレイ）
       通信中は全画面を覆い、重複操作を完全にブロックする
       ============================================================ -->
  <div id="loading-overlay">
    <div class="spinner-ring"></div>
    <p class="spinner-text">データを<ruby>読<rt>よ</rt></ruby>み<ruby>込<rt>こ</rt></ruby>んでいます...</p>
  </div>

  <!-- ============================================================
       アプリ本体ラッパー
       ============================================================ -->
  <div id="app-wrapper">

    <!-- ── ヘッダー ── -->
    <? if (user.role === '担任') { ?>
    <header class="app-header teacher-header">
      <h1 class="app-header-title">
        <i class="bi bi-clipboard2-data-fill"></i> 教員ダッシュボード
      </h1>
      <span class="user-badge">
        <i class="bi bi-person-circle"></i>
        <?= user.name ?> 先生
      </span>
    </header>
    <? } else { ?>
    <header class="app-header">
      <h1 class="app-header-title">
        <i class="bi bi-journal-richtext"></i> ふり<ruby>返<rt>かえ</rt></ruby>りジャーナル
      </h1>
      <span class="user-badge">
        <i class="bi bi-person-circle"></i>
        <?= user.name ?> さん
      </span>
    </header>
    <? } ?>

    <!-- ── メインコンテンツ ── -->
    <div class="main-content">
      <!-- ※ js.html の renderStudentView() / renderTeacherView() がここに描画する -->
      <div id="app-content"></div>
    </div>

    <!-- ── 固定フッター ── -->
    <footer class="text-center text-muted py-3 mt-4 border-top">
      <small>© 2026 ふり返りジャーナル <a href="https://note.com/cute_borage86" target="_blank"
          class="text-decoration-none text-muted">GIGA山</a></small>
    </footer>

  </div><!-- /app-wrapper -->

  <!-- ============================================================
       画像全画面表示オーバーレイ
       ============================================================ -->
  <div id="fullscreen-image-overlay" class="fullscreen-overlay">
    <span class="fullscreen-close-btn">&times;</span>
    <img class="fullscreen-content" id="fullscreen-image" alt="">
  </div>

  <!-- ============================================================
       ハイライト機能用 UI 要素
       ============================================================ -->
  <div id="selection-popover"><button id="add-highlight-btn"><i class="bi bi-highlighter"></i> ハイライト</button></div>
  <div id="highlight-editor"></div>
  <div id="highlight-tooltip"></div>

  <!-- ── Bootstrap 5 JS (CDN) ── -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ── SweetAlert2 JS (CDN) ── -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- ── サーバーサイドデータの注入（テンプレートタグはここでのみ使用） ── -->
  <script>
    const userData = <?!= JSON.stringify(user) ?>;
    const todayTheme = <?!= JSON.stringify(todayTheme) ?>;
    let journalsData = <?!= JSON.stringify(journals) ?>;
    const isAdmin = <?!= JSON.stringify(isAdmin) ?>;
    <? if (user.role === '担任') { ?>
      const classRoster = <?!= JSON.stringify(classRoster) ?>;
    <? } else { ?>
      const classRoster = [];
    <? } ?>
  </script>

  <!-- ── アプリ固有JS（js.html） ── -->
  <?!= include('js') ?>

</body>

</html>
